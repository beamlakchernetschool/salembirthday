<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, Salem!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Tone.js library for audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* General styling for a retro, pixelated feel */
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #f7d2e7;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }
        .game-container {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            border: 8px solid #333;
            box-shadow: 12px 12px 0px #e0a7c4;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .character-art {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            min-height: 150px;
        }
        .character-art svg {
            width: 100%;
            height: 100%;
            max-height: 150px;
        }
        .text-box {
            font-size: 14px;
            line-height: 1.5;
            min-height: 150px;
            background-color: #e0f2f1;
            border: 4px solid #333;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            white-space: pre-wrap; /* Preserve formatting for dialogue */
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        .game-button {
            background-color: #5d5d5d;
            color: white;
            border: 4px solid #333;
            padding: 15px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.1s ease;
            box-shadow: 4px 4px 0px #333;
            text-align: left;
            border-radius: 5px;
        }
        .game-button:hover {
            background-color: #7a7a7a;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #333;
        }
        .game-button:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px #333;
        }
        
        /* SVG Pixel Art Styles */
        .pixel { fill: #333; }
        .pixel-light-skin { fill: #fdd8b1; }
        .pixel-dark-skin { fill: #c79188; }
        .pixel-very-light-skin { fill: #ffe0b2; }
        .pixel-dark-hair { fill: #2c1a1a; }
        .pixel-shirt-beamlak { fill: #63d1f4; }
        .pixel-shirt-salem { fill: #f381a8; }
        .pixel-shirt-kidus { fill: #9c63f4; }
        .pixel-bg-aastu { fill: #e0f7fa; }
        .pixel-bg-icl { fill: #e8f5e9; }
        .pixel-bg-bowling { fill: #ffecb3; }
        .pixel-bg-home { fill: #c6e2ff; }
        .pixel-cake { fill: #ff70a6; }
        .pixel-candle { fill: #fff; }
        .pixel-flame { fill: #ffeb3b; }
        
        .start-screen {
            font-size: 18px;
            white-space: pre-wrap;
            line-height: 1.8;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- SVG Pixel Art Container -->
        <div class="character-art" id="character-art">
            <!-- SVG will be dynamically inserted here -->
        </div>
        <!-- Main game text area -->
        <div id="text-box" class="text-box"></div>
        <!-- Choice buttons -->
        <div id="options-container" class="options-container"></div>
    </div>

    <script>
        // --- Audio Setup with Tone.js ---

        // A synth for the background music
        const musicSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: 'square' },
            envelope: {
                attack: 0.05,
                decay: 0.1,
                sustain: 0.2,
                release: 0.5,
            }
        }).toDestination();

        // A simple melody for the birthday music
        const birthdayMelody = [
            { note: 'C4', time: 0 },
            { note: 'C4', time: '4n' },
            { note: 'D4', time: '2n' },
            { note: 'C4', time: '2n + 4n' },
            { note: 'F4', time: '1n' },
            { note: 'E4', time: '1n + 4n' },
            { note: 'C4', time: '2n + 4n' },
            { note: 'C4', time: '2n + 4n + 4n' },
            { note: 'D4', time: '1n + 2n' },
            { note: 'C4', time: '1n + 2n + 4n' },
            { note: 'G4', time: '2n' },
            { note: 'F4', time: '2n + 4n' }
        ];

        // The sequence to play the melody on repeat
        let musicSequence = null;

        // A synth for the click sound effect
        const clickSynth = new Tone.Synth({
            oscillator: { type: 'sine' },
            envelope: {
                attack: 0.01,
                decay: 0.1,
                sustain: 0,
                release: 0.1
            }
        }).toDestination();

        // Function to start the background music
        function startMusic() {
            if (!musicSequence) {
                musicSequence = new Tone.Sequence((time, noteInfo) => {
                    musicSynth.triggerAttackRelease(noteInfo.note, '8n', time);
                }, birthdayMelody).start(0);

                Tone.Transport.loop = true;
                Tone.Transport.loopEnd = '4m';
            }
            Tone.Transport.start();
        }

        // Function to stop the background music
        function stopMusic() {
            if (musicSequence) {
                Tone.Transport.stop();
            }
        }

        // Global click listener for the click sound effect
        document.addEventListener('click', () => {
            clickSynth.triggerAttackRelease('C5', '8n');
        });

        // Game state and data
        const gameData = {
            currentScene: 'start_screen',
            player: { name: 'Salem', skin: 'pixel-very-light-skin', hair: 'pixel-dark-hair', shirt: 'pixel-shirt-salem' },
            characters: {
                beamlak: { name: 'Beamlak', skin: 'pixel-light-skin', hair: 'pixel-dark-hair', shirt: 'pixel-shirt-beamlak' },
                kidus: { name: 'Kidus', skin: 'pixel-dark-skin', hair: 'pixel-dark-hair', shirt: 'pixel-shirt-kidus' }
            },
            scenes: {
                start_screen: {
                    text: "Happy Birthday, Salem!\nToday you are the star of the show ‚Äî YOU!\nNavigate your special day full of weird friends, family, and surprises.\nCan you survive Beamlak‚Äôs pathogenic antics and Kidus‚Äôs holy bullying?\nLet‚Äôs find out!\n\nTap to begin‚Ä¶",
                    art: 'salem_intro',
                    options: []
                },
                scene_1: {
                    text: "You wake up to the sound of your phone buzzing. Another message from Beamlak.\n\nBeamlak: \"Ready for your birthday? Time to endure the pathogenic nonsense. üòé\"\n\nYou smile. Your best friend is weird but you love to hate him.",
                    art: 'aastu_dorm',
                    options: [
                        { text: "Reply: \"Bring it on, Beamlak. I‚Äôm ready for anything.\"", nextScene: 'scene_2' },
                        { text: "Reply: \"Pathogenic? More like pathetic. LOL.\"", nextScene: 'scene_2' },
                        { text: "Ignore and get up slowly.", nextScene: 'scene_2' }
                    ]
                },
                scene_2: {
                    text: "You arrive at the ICL medical institution where you and Beamlak intern. Today‚Äôs tests: blood counting, molecular diagnostics, microbiology.\n\nBeamlak is already there, messing with a microscope.\n\nBeamlak: ‚ÄúHey Salem! Remember when I totally destroyed you in bowling? The king of bowling strikes again! Haha!‚Äù\n\nYou roll your eyes.",
                    art: 'icl',
                    options: [
                        { text: "\"A winner's grin never lies? Nice try.\"", nextScene: 'scene_3_start' },
                        { text: "\"Bowling was a fluke! This time I‚Äôll show you who‚Äôs boss.\"", nextScene: 'scene_3_start' },
                        { text: "\"At least I‚Äôm not the one who still can‚Äôt use Snapchat properly.\"", nextScene: 'scene_3_start' }
                    ]
                },
                scene_3_start: {
                    text: "Beamlak dares you for a bowling rematch at the nearby alley.\n\nBeamlak: ‚ÄúGet ready to lose again. I'm the bowling king!‚Äù\n\nYou take your stance, ready to roll the ball. \n\nTap the button to roll the ball.",
                    art: 'bowling',
                    options: [] // No button options for the mini-game
                },
                scene_3_win: {
                    text: "You strike like a champion! Beamlak looks genuinely shocked. ‚ÄòNo way... You‚Äôre cheating!‚Äô",
                    art: 'bowling',
                    options: [
                        { text: "Move on to the next scene.", nextScene: 'scene_4' }
                    ]
                },
                scene_3_lose: {
                    text: "Beamlak wins again. ‚ÄòPathogenic liar!‚Äô he shouts, laughing. You glare playfully.",
                    art: 'bowling',
                    options: [
                        { text: "Move on to the next scene.", nextScene: 'scene_4' }
                    ]
                },
                scene_4: {
                    text: "Remember when you set Beamlak up with Snapchat? What a disaster.\n\nBeamlak: ‚ÄúI still don‚Äôt get all those filters. Alien mode activated.‚Äù\n\nYou: ‚ÄúYou looked so confused, like a lost organism in a petri dish.‚Äù",
                    art: 'beamlak',
                    options: [
                        { text: "‚ÄúSend him a snap with a funny filter.‚Äù", nextScene: 'scene_5' },
                        { text: "‚ÄúTell him to just stick to text messages.‚Äù", nextScene: 'scene_5' },
                        { text: "‚ÄúCall him a ‚ÄòSnapchat noob.‚Äô‚Äù", nextScene: 'scene_5' }
                    ]
                },
                scene_5: {
                    text: "Suddenly, Kidus appears, your bro who used to bully you but is now a religious singer.\n\nHe holds a microphone and starts singing a pixelated hymn‚Ä¶ slightly off-key.\n\nKidus: ‚ÄúRepent, repent! Even Beamlak‚Äôs pathological lies won‚Äôt save him!‚Äù\n\nYou smirk.",
                    art: 'kidus',
                    options: [
                        { text: "‚ÄúChallenge Kidus to a sing-off. Winner gets bragging rights.‚Äù", nextScene: 'scene_6' },
                        { text: "‚ÄúTell him to keep the holy bullying to a minimum.‚Äù", nextScene: 'scene_6' },
                        { text: "‚ÄúAsk if he can sing something less scary.‚Äù", nextScene: 'scene_6' }
                    ]
                },
                scene_6: {
                    text: "You arrive home, thinking the day is over. Suddenly, Beamlak appears, holding a pixelated birthday cake with candles lit.\n\nBeamlak: ‚ÄúSurprise, Salem! Happy birthday! No pathogenic lies here, just love (and weirdness).‚Äù\n\nConfetti rains down as the cake glows on screen.",
                    art: 'home_with_cake',
                    options: [
                        { text: "‚ÄúThank you, Beamlak! You‚Äôre weird but I love it.‚Äù", nextScene: 'game_end' },
                        { text: "‚ÄúCan we eat the cake before you say something else weird?‚Äù", nextScene: 'game_end' },
                        { text: "‚ÄúLet‚Äôs plan the next weird adventure ‚Äî but no more bullying, okay?‚Äù", nextScene: 'game_end' }
                    ]
                },
                game_end: {
                    text: "Thanks for playing ‚ÄúSalem‚Äôs Birthday Quest!‚Äù\n\nCreated by Beamlak ‚Äî your pathogenic best friend.",
                    art: 'final',
                    options: [
                        { text: "Play Again", nextScene: 'start_screen' }
                    ]
                }
            }
        };

        // SVG Pixel Art definitions for characters and backgrounds
        const characterSVGs = {
            salem_intro: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="50" y="80" width="50" height="70" class="pixel pixel-shirt-salem"/> <rect x="65" y="70" width="20" height="10" class="pixel pixel-very-light-skin"/> <rect x="60" y="60" width="30" height="10" class="pixel pixel-very-light-skin"/> <rect x="55" y="50" width="40" height="10" class="pixel pixel-very-light-skin"/> <rect x="50" y="40" width="50" height="10" class="pixel pixel-very-light-skin"/> <rect x="55" y="30" width="40" height="10" class="pixel pixel-dark-hair"/> <rect x="45" y="20" width="60" height="10" class="pixel pixel-dark-hair"/> <rect x="40" y="10" width="70" height="10" class="pixel pixel-dark-hair"/> <rect x="60" y="45" width="5" height="5" class="pixel"/> <rect x="85" y="45" width="5" height="5" class="pixel"/> <rect x="65" y="55" width="20" height="5" class="pixel"/> </svg>`,
            beamlak: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="50" y="80" width="50" height="70" class="pixel pixel-shirt-beamlak"/> <rect x="65" y="70" width="20" height="10" class="pixel pixel-light-skin"/> <rect x="60" y="60" width="30" height="10" class="pixel pixel-light-skin"/> <rect x="55" y="50" width="40" height="10" class="pixel pixel-light-skin"/> <rect x="50" y="40" width="50" height="10" class="pixel pixel-light-skin"/> <rect x="55" y="30" width="40" height="10" class="pixel pixel-dark-hair"/> <rect x="45" y="20" width="60" height="10" class="pixel pixel-dark-hair"/> <rect x="40" y="10" width="70" height="10" class="pixel pixel-dark-hair"/> <rect x="60" y="45" width="5" height="5" class="pixel"/> <rect x="85" y="45" width="5" height="5" class="pixel"/> <rect x="65" y="55" width="20" height="5" class="pixel"/> </svg>`,
            kidus: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="50" y="80" width="50" height="70" class="pixel pixel-shirt-kidus"/> <rect x="65" y="70" width="20" height="10" class="pixel pixel-dark-skin"/> <rect x="60" y="60" width="30" height="10" class="pixel pixel-dark-skin"/> <rect x="55" y="50" width="40" height="10" class="pixel pixel-dark-skin"/> <rect x="50" y="40" width="50" height="10" class="pixel pixel-dark-skin"/> <rect x="55" y="30" width="40" height="10" class="pixel pixel-dark-hair"/> <rect x="45" y="20" width="60" height="10" class="pixel pixel-dark-hair"/> <rect x="40" y="10" width="70" height="10" class="pixel pixel-dark-hair"/> <rect x="60" y="45" width="5" height="5" class="pixel"/> <rect x="85" y="45" width="5" height="5" class="pixel"/> <rect x="65" y="55" width="20" height="5" class="pixel"/> </svg>`,
            aastu_dorm: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="0" y="0" width="150" height="150" class="pixel-bg-aastu"/> <rect x="20" y="80" width="110" height="20" fill="#fff"/> <rect x="40" y="90" width="70" height="60" fill="#a0522d"/> <rect x="60" y="95" width="30" height="40" fill="#333"/> <text x="75" y="145" font-family="'Press Start 2P', cursive" font-size="10" text-anchor="middle" fill="#fff">AASTU</text> </svg>`,
            icl: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="0" y="0" width="150" height="150" class="pixel-bg-icl"/> <rect x="30" y="50" width="90" height="80" fill="#b2dfdb"/> <rect x="40" y="60" width="70" height="60" fill="#fff"/> <circle cx="75" cy="90" r="15" fill="#e0e0e0"/> <rect x="100" y="80" width="15" height="40" fill="#bdbdbd"/> <text x="75" y="140" font-family="'Press Start 2P', cursive" font-size="10" text-anchor="middle" fill="#333">ICL</text> </svg>`,
            bowling: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="0" y="0" width="150" height="150" class="pixel-bg-bowling"/> <rect x="40" y="100" width="15" height="50" fill="#fff"/> <rect x="60" y="90" width="15" height="60" fill="#fff"/> <rect x="80" y="100" width="15" height="50" fill="#fff"/> <rect x="20" y="120" width="10" height="10" fill="#333"/> <rect x="120" y="120" width="10" height="10" fill="#333"/> <text x="75" y="80" font-family="'Press Start 2P', cursive" font-size="10" text-anchor="middle" fill="#333">Bowling!</text> </svg>`,
            kidus_mic: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="50" y="80" width="50" height="70" class="pixel pixel-shirt-kidus"/> <rect x="65" y="70" width="20" height="10" class="pixel pixel-dark-skin"/> <rect x="60" y="60" width="30" height="10" class="pixel pixel-dark-skin"/> <rect x="55" y="50" width="40" height="10" class="pixel pixel-dark-skin"/> <rect x="50" y="40" width="50" height="10" class="pixel pixel-dark-skin"/> <rect x="55" y="30" width="40" height="10" class="pixel pixel-dark-hair"/> <rect x="45" y="20" width="60" height="10" class="pixel pixel-dark-hair"/> <rect x="40" y="10" width="70" height="10" class="pixel pixel-dark-hair"/> <rect x="60" y="45" width="5" height="5" class="pixel"/> <rect x="85" y="45" width="5" height="5" class="pixel"/> <rect x="65" y="55" width="20" height="5" class="pixel"/> <rect x="100" y="50" width="10" height="50" fill="#9e9e9e"/> <rect x="100" y="40" width="10" height="10" fill="#333"/> </svg>`,
            home_with_cake: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="0" y="0" width="150" height="150" class="pixel-bg-home"/> <rect x="40" y="80" width="70" height="30" class="pixel-cake"/> <rect x="45" y="70" width="60" height="10" fill="#f48fb1"/> <rect x="50" y="60" width="50" height="10" class="pixel-cake"/> <rect x="55" y="50" width="40" height="10" fill="#f48fb1"/> <rect x="65" y="40" width="5" height="10" class="pixel-candle"/> <rect x="75" y="40" width="5" height="10" class="pixel-candle"/> <rect x="65" y="35" width="5" height="5" class="pixel-flame"/> <rect x="75" y="35" width="5" height="5" class="pixel-flame"/> <text x="75" y="140" font-family="'Press Start 2P', cursive" font-size="10" text-anchor="middle" fill="#333">Happy Bday!</text> </svg>`,
            final: `<svg width="150" height="150" viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg"> <rect x="0" y="0" width="150" height="150" fill="#ffc107"/> <rect x="30" y="40" width="90" height="10" fill="#f44336"/> <rect x="40" y="50" width="70" height="10" fill="#e91e63"/> <rect x="50" y="60" width="50" height="10" fill="#9c27b0"/> <rect x="60" y="70" width="30" height="10" fill="#3f51b5"/> <rect x="70" y="80" width="10" height="10" fill="#03a9f4"/> <text x="75" y="110" font-family="'Press Start 2P', cursive" font-size="10" text-anchor="middle" fill="#333">Happy Birthday!</text> </svg>`
        };

        // Function to display a scene
        function showScene(sceneId) {
            const scene = gameData.scenes[sceneId];
            const artContainer = document.getElementById('character-art');
            const textBox = document.getElementById('text-box');
            const optionsContainer = document.getElementById('options-container');

            // Clear previous content
            artContainer.innerHTML = '';
            optionsContainer.innerHTML = '';

            // Update character art
            if (scene.art) {
                artContainer.innerHTML = characterSVGs[scene.art];
            } else {
                artContainer.innerHTML = ''; // Hide art if none specified
            }

            // Update text
            textBox.innerText = scene.text;

            // Create buttons for options
            if (scene.options.length > 0) {
                optionsContainer.style.display = 'flex';
                scene.options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('game-button');
                    button.innerText = option.text;
                    button.onclick = () => makeChoice(option.nextScene);
                    optionsContainer.appendChild(button);
                });
            } else {
                 optionsContainer.style.display = 'none';
            }

             if (sceneId === 'start_screen') {
                const startButton = document.createElement('button');
                startButton.classList.add('game-button');
                startButton.innerText = "Tap to Begin";
                startButton.style.textAlign = 'center';
                startButton.onclick = async () => {
                    await Tone.start();
                    startMusic();
                    makeChoice('scene_1');
                };
                optionsContainer.appendChild(startButton);
                optionsContainer.style.display = 'flex';
            } else if (sceneId === 'scene_3_start') {
                const bowlButton = document.createElement('button');
                bowlButton.classList.add('game-button');
                bowlButton.innerText = "BOWL!";
                bowlButton.style.textAlign = 'center';
                bowlButton.onclick = () => {
                    if (Math.random() < 0.5) {
                        makeChoice('scene_3_win');
                    } else {
                        makeChoice('scene_3_lose');
                    }
                };
                optionsContainer.appendChild(bowlButton);
                optionsContainer.style.display = 'flex';
            } else if (sceneId === 'game_end') {
                // Stop music when the game ends
                stopMusic();
                const playAgainButton = document.createElement('button');
                playAgainButton.classList.add('game-button');
                playAgainButton.innerText = "Play Again";
                playAgainButton.style.textAlign = 'center';
                playAgainButton.onclick = () => makeChoice('start_screen');
                optionsContainer.appendChild(playAgainButton);
                optionsContainer.style.display = 'flex';
            }
        }

        // Function to handle choices
        function makeChoice(nextSceneId) {
            gameData.currentScene = nextSceneId;
            showScene(gameData.currentScene);
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            showScene(gameData.currentScene);
        });
    </script>
</body>
</html>
